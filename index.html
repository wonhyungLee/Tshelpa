<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸŒŒ íƒœì–‘ê³„ íƒí—˜ â€“ í–‰ì„±ê³¼ ê¶¤ë„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /*
      ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì •
      í•™ìƒë“¤ì´ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì–´ë‘ìš´ ìš°ì£¼ ë°°ê²½ê³¼ ë°ì€ í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.
      ë ˆì´ì•„ì›ƒì€ ì¢Œì¸¡ì— ì»¨íŠ¸ë¡¤, ìš°ì¸¡ì— ì‹œê°í™”ë¥¼ ë°°ì¹˜í•œë‹¤.
    */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-main: #020617;
      --bg-panel: rgba(15, 23, 42, 0.95);
      --bg-panel-soft: rgba(15, 23, 42, 0.85);
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.3);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.4);
      --danger: #fb7185;
      --success: #4ade80;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #020617 0, #000000 60%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .app {
      flex: 1;
      display: flex;
      gap: 16px;
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .left-panel {
      flex: 0 0 360px;
      max-width: 380px;
      background: var(--bg-panel);
      border-radius: 16px;
      padding: 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .right-panel {
      flex: 1;
      background: var(--bg-panel-soft);
      border-radius: 16px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.3);
      overflow: hidden;
      position: relative;
    }

    h1 {
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    h1 span.emoji {
      font-size: 1.6rem;
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .tagline {
      font-size: 0.82rem;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid var(--accent-soft);
      font-size: 0.75rem;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .badge small {
      color: var(--text-muted);
    }

    .controls-card {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), rgba(2, 6, 23, 0.9));
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .controls-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .control-row {
      margin-bottom: 8px;
    }

    .control-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 2px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .control-label span.value {
      color: var(--accent);
      font-weight: 600;
      font-size: 0.8rem;
    }

    input[type="range"] {
      width: 100%;
      accent-color: var(--accent);
    }

    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.8);
      color: var(--text-main);
      font-size: 0.85rem;
    }

    .orbit-mode-group {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    button {
      cursor: pointer;
      border: none;
      font-size: 0.8rem;
    }

    .orbit-mode-btn,
    .quiz-toggle-btn {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      border: 1px solid var(--border-subtle);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .orbit-mode-btn.active {
      background: rgba(56, 189, 248, 0.15);
      border-color: var(--accent);
      color: var(--accent);
    }

    .quiz-toggle-btn {
      background: rgba(56, 189, 248, 0.12);
      border-color: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .quiz-toggle-btn:hover {
      background: rgba(56, 189, 248, 0.2);
    }

    .planet-info-card {
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.95);
      border-left: 3px solid var(--accent);
      border-top: 1px solid var(--border-subtle);
      border-right: 1px solid var(--border-subtle);
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.8rem;
    }

    .planet-info-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .planet-name {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .planet-chip {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      color: var(--accent);
    }

    .planet-stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 4px 10px;
      margin-bottom: 6px;
    }

    .planet-stat-label {
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .planet-stat-value {
      font-size: 0.8rem;
      font-weight: 500;
    }

    .planet-desc {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .quiz-section {
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px dashed rgba(148, 163, 184, 0.6);
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .quiz-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .quiz-status {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .quiz-content {
      margin-top: 4px;
    }

    .quiz-intro {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .quiz-question {
      margin-bottom: 6px;
      font-weight: 600;
    }

    .quiz-options {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 4px;
    }

    .quiz-options li {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      padding: 4px 6px;
    }

    .quiz-options label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .quiz-input {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 0.8rem;
      margin-bottom: 4px;
    }

    .quiz-controls {
      display: flex;
      gap: 6px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .quiz-btn {
      padding: 5px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border-subtle);
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
    }

    .quiz-btn.primary {
      background: rgba(56, 189, 248, 0.2);
      border-color: var(--accent-soft);
      color: var(--accent);
    }

    .quiz-btn:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .quiz-hint {
      font-size: 0.75rem;
      color: var(--accent);
      min-height: 16px;
    }

    .quiz-feedback {
      font-size: 0.78rem;
      margin-top: 2px;
    }

    .quiz-feedback.correct {
      color: var(--success);
    }

    .quiz-feedback.wrong {
      color: var(--danger);
    }

    .quiz-rule {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .quiz-result {
      font-size: 0.82rem;
      margin-bottom: 2px;
    }

    .quiz-grade {
      font-size: 0.8rem;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .primary-btn {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      background: rgba(56, 189, 248, 0.25);
      color: var(--accent);
      font-size: 0.8rem;
      font-weight: 600;
    }

    .canvas-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .canvas-header h2 {
      font-size: 1rem;
    }

    .canvas-note {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .canvas-container {
      flex: 1;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: radial-gradient(circle at 20% 0, #020617 0, #000 45%, #020617 100%);
      overflow: hidden;
      position: relative;
      margin-top: 6px;
    }

    #solarCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .canvas-tip {
      position: absolute;
      bottom: 8px;
      right: 10px;
      font-size: 0.7rem;
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.7);
      padding: 4px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      backdrop-filter: blur(4px);
    }

    #planetPopup {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    #planetPopup.visible {
      display: flex;
    }

    .popup-card {
      width: min(340px, 90vw);
      background: rgba(15, 23, 42, 0.98);
      border-radius: 16px;
      padding: 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.8);
      font-size: 0.8rem;
    }

    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .popup-title {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .popup-close {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: transparent;
      color: var(--text-muted);
      font-size: 0.8rem;
      cursor: pointer;
    }

    .popup-body {
      margin-top: 4px;
    }

    .popup-body p {
      margin-bottom: 4px;
    }

    .popup-scale-note {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .popup-img-wrap {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: rgba(2, 6, 23, 0.6);
      overflow: hidden;
      margin-bottom: 6px;
      display: block;
    }
    .popup-img-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .footer {
      border-top: 1px solid rgba(31, 41, 55, 0.9);
      background: rgba(15, 23, 42, 0.98);
      padding: 8px 16px;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .footer-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      align-items: center;
      justify-content: space-between;
    }

    .footer small {
      display: block;
    }

    .footer strong {
      color: var(--accent);
      font-weight: 500;
    }

    @media (max-width: 900px) {
      .app {
        flex-direction: column;
      }

      .left-panel {
        flex: 0 0 auto;
        max-width: 100%;
        order: 1;
      }

      .right-panel {
        order: 0;
        min-height: 340px;
      }

      .canvas-container {
        min-height: 260px;
      }
    }

    @media (max-width: 640px) {
      .quiz-controls {
        flex-direction: column;
        align-items: flex-start;
      }

      .footer-inner {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- ì™¼ìª½ íŒ¨ë„: ì»¨íŠ¸ë¡¤ ë° ì •ë³´ -->
    <aside class="left-panel">
      <header>
        <!-- êµê³¼ì„œ ë°°ì§€ -->
        <div class="badge">
          <span>ì¤‘í•™ ê³¼í•™1(ì„ì„±ìˆ™) Â· 7-1 &lt;íƒœì–‘ê³„ì˜ êµ¬ì„±ì›&gt;</span>
          <small>228~233ìª½</small>
        </div>
        <h1>
          <span class="emoji">ğŸŒŒ</span>
          <span>íƒœì–‘ê³„ íƒí—˜ â€“ í–‰ì„±ê³¼ ê¶¤ë„</span>
        </h1>
        <p class="subtitle">
          8í–‰ì„±ì˜ ìƒëŒ€ì  ê±°ë¦¬Â·ê³µì „ ì£¼ê¸°Â·ê³µì „ ë°©í–¥ì„ 3D ì‹œê°í™”ì™€ í€´ì¦ˆë¡œ ìµí˜€ìš”.
        </p>
        <p class="tagline">
          ì‹œê°„ ë°°ìœ¨Â·ê¶¤ë„ ëª¨ë“œÂ·í€´ì¦ˆë¥¼ ì¡°ì‘í•˜ë©° ë‚˜ë§Œì˜ íƒœì–‘ê³„ ìˆ˜ì—… ì½˜í…ì¸ ë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”.
        </p>
      </header>

      <!-- ì¡°ì‘ íŒ¨ë„ -->
      <section class="controls-card" aria-label="ì¡°ì‘ íŒ¨ë„">
        <div class="controls-title">ì¡°ì‘ íŒ¨ë„</div>

        <!-- ì‹œë®¬ë ˆì´ì…˜ ì œì–´ -->
        <div class="control-row" aria-label="ì‹œë®¬ë ˆì´ì…˜ ì œì–´">
          <div class="orbit-mode-group">
            <button type="button" id="playPauseBtn" class="orbit-mode-btn" aria-pressed="true">â¸ï¸ ì¼ì‹œì •ì§€</button>
            <button type="button" id="resetViewBtn" class="orbit-mode-btn">ğŸ”„ ë³´ê¸° ì´ˆê¸°í™”</button>
            <button type="button" id="screenshotBtn" class="orbit-mode-btn">ğŸ“· ìŠ¤í¬ë¦°ìƒ·</button>
          </div>
        </div>

        <!-- ì‹œê°„ ë°°ìœ¨ ìŠ¬ë¼ì´ë” -->
        <div class="control-row">
          <div class="control-label">
            <span>ì‹œê°„ ë°°ìœ¨</span>
            <span class="value" id="timeScaleLabel">x100</span>
          </div>
          <input
            type="range"
            id="timeScale"
            min="1"
            max="1000"
            value="100"
          />
        </div>

        <!-- í–‰ì„± ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
        <div class="control-row">
          <div class="control-label">
            <span>í–‰ì„± ì„ íƒ</span>
            <span class="value">í´ë¦­í•˜ê±°ë‚˜ ëª©ë¡ì—ì„œ ì„ íƒ</span>
          </div>
          <select id="planetSelect">
            <option value="0">ìˆ˜ì„± (Mercury)</option>
            <option value="1">ê¸ˆì„± (Venus)</option>
            <option value="2" selected>ì§€êµ¬ (Earth)</option>
            <option value="3">í™”ì„± (Mars)</option>
            <option value="4">ëª©ì„± (Jupiter)</option>
            <option value="5">í† ì„± (Saturn)</option>
            <option value="6">ì²œì™•ì„± (Uranus)</option>
            <option value="7">í•´ì™•ì„± (Neptune)</option>
          </select>
        </div>

        <!-- ê¶¤ë„ ë³´ê¸° ëª¨ë“œ -->
        <div class="control-row">
          <div class="control-label">
            <span>ê¶¤ë„ ë³´ê¸° ëª¨ë“œ</span>
          </div>
          <div class="orbit-mode-group">
            <button
              type="button"
              class="orbit-mode-btn active"
              data-mode="2d"
            >
              2D í‰ë©´
            </button>
            <button
              type="button"
              class="orbit-mode-btn"
              data-mode="3d"
            >
              3D ê¶¤ë„ ëŠë‚Œ
            </button>
            <button
              type="button"
              class="orbit-mode-btn"
              data-mode="constellation"
            >
              ì§€êµ¬ì—ì„œ ë³¸ í–‰ì„±
            </button>
          </div>
        </div>

        <!-- ë³´ê¸° ì˜µì…˜ -->
        <div class="control-row" aria-label="ë³´ê¸° ì˜µì…˜">
          <div class="control-label">
            <span>ë³´ê¸° ì˜µì…˜</span>
          </div>
          <div class="orbit-mode-group">
            <button type="button" id="toggleOrbitsBtn" class="orbit-mode-btn active" aria-pressed="true">ê¶¤ë„ í‘œì‹œ</button>
            <button type="button" id="toggleLabelsBtn" class="orbit-mode-btn" aria-pressed="false">í–‰ì„± ì´ë¦„</button>
          </div>
        </div>

        <!-- ë³„ìë¦¬ ë³´ê¸° ì˜µì…˜ -->
        <div class="control-row" aria-label="ë³„ìë¦¬ ë³´ê¸° ì˜µì…˜">
          <div class="control-label">
            <span>ë³„ìë¦¬ ë³´ê¸°(ì§€êµ¬ ì‹œì )</span>
            <span class="value">ì²œë™ì„¤Â·ì§€ë™ì„¤ ë¹„êµ</span>
          </div>
          <div class="orbit-mode-group">
            <button type="button" id="toggleSkyCenterBtn" class="orbit-mode-btn active" aria-pressed="true">ì§€êµ¬ì¤‘ì‹¬</button>
            <button type="button" id="toggleSkyTrailsBtn" class="orbit-mode-btn active" aria-pressed="true">ê¶¤ì  í‘œì‹œ</button>
            <button type="button" id="toggleRetrogradeBtn" class="orbit-mode-btn active" aria-pressed="true">ì—­í–‰ ê°•ì¡°</button>
          </div>
        </div>

        <!-- í€´ì¦ˆ ëª¨ë“œ ë²„íŠ¼ -->
        <div class="control-row">
          <button
            type="button"
            class="quiz-toggle-btn"
            id="quizToggleBtn"
          >
            ğŸ§  í€´ì¦ˆ ëª¨ë“œ ì‹œì‘
          </button>
        </div>
      </section>

      <!-- í–‰ì„± ì •ë³´ ì¹´ë“œ -->
      <section class="planet-info-card" aria-live="polite">
        <div class="planet-info-header">
          <div class="planet-name" id="planetName">
            ì§€êµ¬ (Earth)
          </div>
          <div class="planet-chip">í–‰ì„± ì •ë³´</div>
        </div>
        <div class="planet-stats">
          <div>
            <div class="planet-stat-label">ë°˜ì§€ë¦„</div>
            <div class="planet-stat-value" id="planetRadius">
              6,371 km
            </div>
          </div>
          <div>
            <div class="planet-stat-label">ê³µì „ ì£¼ê¸°</div>
            <div class="planet-stat-value" id="planetOrbit">
              365ì¼
            </div>
          </div>
          <div>
            <div class="planet-stat-label">ìì „ ì£¼ê¸°</div>
            <div class="planet-stat-value" id="planetRotation">
              24ì‹œê°„
            </div>
          </div>
          <div>
            <div class="planet-stat-label">í‘œë©´ ì˜¨ë„</div>
            <div class="planet-stat-value" id="planetTemp">
              ~15â„ƒ (í‰ê· )
            </div>
          </div>
        </div>
        <p class="planet-desc" id="planetDesc">
          ë¬¼ê³¼ ëŒ€ê¸°ê°€ ì¡´ì¬í•˜ë©°, ìš°ë¦¬ê°€ ì‚´ê³  ìˆëŠ” í–‰ì„±ì…ë‹ˆë‹¤. ìƒëª…ì²´ê°€ ë°œê²¬ëœ ìœ ì¼í•œ í–‰ì„±ì…ë‹ˆë‹¤.
        </p>
      </section>

      <!-- í€´ì¦ˆ ì˜ì—­ -->
      <section class="quiz-section" aria-label="íƒœì–‘ê³„ í€´ì¦ˆ">
        <div class="quiz-header-row">
          <div class="controls-title">íƒœì–‘ê³„ íƒí—˜ í€´ì¦ˆ</div>
          <div class="quiz-status" id="quizStatus">
            ì ìˆ˜: 0ì  | ë¬¸ì œ 0 / 0
          </div>
        </div>
        <div class="quiz-content" id="quizContent">
          <p class="quiz-intro">
            ì™¼ìª½ ìœ„ì˜ <strong>ğŸ§  í€´ì¦ˆ ëª¨ë“œ ì‹œì‘</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬
            í–‰ì„± ì •ë³´ì— ê´€í•œ ê°ê´€ì‹Â·ì£¼ê´€ì‹ ë¬¸ì œë¥¼ í’€ì–´ ë³´ì„¸ìš”.
          </p>
        </div>
        <div class="quiz-controls" id="quizControls" style="display: none;">
          <button
            type="button"
            class="quiz-btn"
            id="hintBtn"
          >
            ğŸ’¡ íŒíŠ¸ ë³´ê¸° (-1ì )
          </button>
          <button
            type="button"
            class="quiz-btn primary"
            id="submitAnswerBtn"
          >
            âœ… ì •ë‹µ ì œì¶œ
          </button>
          <button
            type="button"
            class="quiz-btn"
            id="nextQuestionBtn"
            disabled
          >
            ë‹¤ìŒ ë¬¸ì œ
          </button>
        </div>
        <p class="quiz-rule">
          ì ìˆ˜ ê·œì¹™: <strong>ì •ë‹µ +2ì </strong>, <strong>ì˜¤ë‹µ 0ì </strong>,
          <strong>íŒíŠ¸ ì‚¬ìš© -1ì </strong> (ìµœì†Œ 0ì ).
        </p>
      </section>
    </aside>

    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„: 3D ì‹œë®¬ë ˆì´ì…˜ -->
    <main class="right-panel" aria-label="íƒœì–‘ê³„ ì‹œê°í™”">
      <div class="canvas-header">
        <h2>íƒœì–‘ê³„ 3D/2D ëª¨ë¸</h2>
        <p class="canvas-note">
          * ì ìš©ëœ ì²œì²´ ê·œëª¨ëŠ” ì‹¤ì œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
      </div>
      <div class="canvas-container">
        <canvas id="solarCanvas" aria-label="íƒœì–‘ê³„ ì‹œë®¬ë ˆì´ì…˜"></canvas>
        <div class="canvas-tip">
          ë“œë˜ê·¸: íšŒì „/ì´ë™ Â· íœ : í™•ëŒ€/ì¶•ì†Œ Â· í–‰ì„± í´ë¦­: í™•ëŒ€ ë° ì •ë³´ ë³´ê¸°
        </div>
      </div>
    </main>
  </div>

  <!-- í–‰ì„± ì„¤ëª… íŒì—… -->
  <div id="planetPopup" role="dialog" aria-modal="true">
    <div class="popup-card">
      <div class="popup-header">
        <div class="popup-title" id="popupPlanetName">í–‰ì„± ì •ë³´</div>
        <button
          type="button"
          class="popup-close"
          id="popupClose"
          aria-label="ë‹«ê¸°"
        >
          âœ•
        </button>
      </div>
      <div class="popup-body">
        <div class="popup-img-wrap">
          <img id="popupPlanetImg" src="" alt="í–‰ì„± ì´ë¯¸ì§€" />
        </div>
        <p id="popupPlanetText">
          í–‰ì„±ì„ í´ë¦­í•˜ë©´ ì´ê³³ì— ê°„ë‹¨í•œ ì„¤ëª…ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
        </p>
        <p class="popup-scale-note">
          â€» ì‹œê°í™”ë¥¼ ìœ„í•´ <strong>ê±°ë¦¬Â·í¬ê¸°Â·ì†ë„ëŠ” ì‹¤ì œ ë¹„ìœ¨ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong>
        </p>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-inner">
      <div>
        <small>
          êµê³¼ì„œ ì •ë³´: <strong>ì¤‘í•™ ê³¼í•™1(ì„ì„±ìˆ™) 7-1 &lt;íƒœì–‘ê³„ì˜ êµ¬ì„±ì›&gt; 228~233ìª½</strong>
        </small>
        <small>ì œì‘/ë¬¸ì˜: <strong>dldnjsrk@gmail.com</strong></small>
      </div>
      <div>
        <small>
          ì´ í˜ì´ì§€ëŠ” ìˆ˜ì—…ìš© ì˜ˆì‹œì´ë©°, ì €ì‘ê¶Œì€ ê° êµê³¼ì„œ ë° ìë£Œì˜ ì›ì €ì‘ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.
        </small>
        <small>
          ì´ ì›¹í˜ì´ì§€ëŠ” <strong>í•™ìƒì˜ ì´ë¦„ì´ë‚˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘Â·ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong>
        </small>
      </div>
    </div>
  </footer>

  <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸: ì‹œë®¬ë ˆì´ì…˜ ë° í€´ì¦ˆ ê¸°ëŠ¥ êµ¬í˜„ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const canvas = document.getElementById("solarCanvas");
      const ctx = canvas.getContext("2d");

      const timeSlider = document.getElementById("timeScale");
      const timeLabel = document.getElementById("timeScaleLabel");
      const planetSelect = document.getElementById("planetSelect");
      const orbitButtons = document.querySelectorAll(".orbit-mode-btn[data-mode]");
      const quizToggleBtn = document.getElementById("quizToggleBtn");
      const playPauseBtn = document.getElementById("playPauseBtn");
      const resetViewBtn = document.getElementById("resetViewBtn");
      const screenshotBtn = document.getElementById("screenshotBtn");
      const toggleOrbitsBtn = document.getElementById("toggleOrbitsBtn");
      const toggleLabelsBtn = document.getElementById("toggleLabelsBtn");
      const toggleSkyCenterBtn = document.getElementById("toggleSkyCenterBtn");
      const toggleSkyTrailsBtn = document.getElementById("toggleSkyTrailsBtn");
      const toggleRetrogradeBtn = document.getElementById("toggleRetrogradeBtn");

      const planetNameElem = document.getElementById("planetName");
      const planetRadiusElem = document.getElementById("planetRadius");
      const planetOrbitElem = document.getElementById("planetOrbit");
      const planetRotationElem = document.getElementById("planetRotation");
      const planetTempElem = document.getElementById("planetTemp");
      const planetDescElem = document.getElementById("planetDesc");

      const popup = document.getElementById("planetPopup");
      const popupPlanetName = document.getElementById("popupPlanetName");
      const popupPlanetText = document.getElementById("popupPlanetText");
      const popupPlanetImg = document.getElementById("popupPlanetImg");
      const popupClose = document.getElementById("popupClose");

      // Footerì— NASA ì¶œì²˜ í¬ë ˆë”§ ë™ì  ì¶”ê°€
      try {
        const firstCol = document.querySelector('.footer-inner > div:first-child');
        if (firstCol && !document.getElementById('nasaCredit')) {
          const credit = document.createElement('small');
          credit.id = 'nasaCredit';
          credit.innerHTML = 'ì´ë¯¸ì§€Â·ê¸°ì´ˆ ì •ë³´ ì¶œì²˜: <strong><a href="https://science.nasa.gov/solar-system/planets/" target="_blank" rel="noopener">NASA Science â€” Planets</a></strong>';
          firstCol.appendChild(credit);
        }
      } catch (e) { /* ignore */ }

      // Placeholder ìƒì„±ê¸°: í–‰ì„±ë³„ ê°„ë‹¨ í…ìŠ¤ì²˜ê°€ í¬í•¨ëœ ì›í˜• ì´ë¯¸ì§€ë¥¼ ìƒì„±
      function generatePlanetPlaceholder(planet, size = 256) {
        const c = document.createElement("canvas");
        c.width = c.height = size;
        const g = c.getContext("2d");
        const cx = size / 2;
        const cy = size / 2;
        const r = size * 0.38;

        // Saturn ê³ ë¦¬(ë°°ê²½, ì–‡ê²Œ)
        if (planet.name === "Saturn") {
          g.save();
          g.translate(cx, cy);
          g.scale(1, 0.6);
          g.beginPath();
          g.ellipse(0, 0, r * 1.55, r * 0.68, 0, 0, Math.PI * 2);
          g.strokeStyle = "rgba(229, 231, 235, 0.6)";
          g.lineWidth = Math.max(1, size * 0.015);
          g.stroke();
          g.restore();
        }

        // ë³¸ì²´ ê·¸ë¼ë””ì–¸íŠ¸
        const baseColor = planet.color || "#9ca3af";
        const grad = g.createRadialGradient(cx - r * 0.4, cy - r * 0.4, r * 0.2, cx, cy, r);
        grad.addColorStop(0, "rgba(255,255,255,0.9)");
        grad.addColorStop(0.45, baseColor);
        grad.addColorStop(1, "rgba(0,0,0,0.85)");
        g.fillStyle = grad;
        g.beginPath();
        g.arc(cx, cy, r, 0, Math.PI * 2);
        g.fill();

        // ê°„ë‹¨ í…ìŠ¤ì²˜
        if (planet.name === "Jupiter" || planet.name === "Saturn") {
          for (let i = -3; i <= 3; i++) {
            g.globalAlpha = 0.12 + (i % 2 ? 0.06 : 0);
            g.fillStyle = "#ffffff";
            g.beginPath();
            g.ellipse(cx, cy + i * r * 0.2, r * 0.92, r * 0.34, 0, 0, Math.PI * 2);
            g.fill();
          }
          g.globalAlpha = 1;
          if (planet.name === "Jupiter") {
            g.beginPath();
            g.ellipse(cx + r * 0.32, cy + r * 0.08, r * 0.22, r * 0.12, 0, 0, Math.PI * 2);
            g.fillStyle = "rgba(239, 68, 68, 0.55)";
            g.fill();
          }
        } else if (planet.name === "Earth") {
          g.fillStyle = "rgba(34,197,94,0.7)";
          g.beginPath();
          g.ellipse(cx - r * 0.2, cy + r * 0.05, r * 0.42, r * 0.26, 0.25, 0, Math.PI * 2);
          g.fill();
          g.beginPath();
          g.ellipse(cx + r * 0.1, cy - r * 0.2, r * 0.28, r * 0.18, -0.2, 0, Math.PI * 2);
          g.fill();
          g.fillStyle = "rgba(234, 179, 8, 0.55)";
          g.beginPath();
          g.ellipse(cx + r * 0.05, cy + r * 0.22, r * 0.18, r * 0.12, 0, 0, Math.PI * 2);
          g.fill();
        } else if (planet.name === "Mars") {
          g.fillStyle = "rgba(180,83,9,0.35)";
          g.beginPath();
          g.ellipse(cx + r * 0.1, cy + r * 0.02, r * 0.5, r * 0.28, 0.4, 0, Math.PI * 2);
          g.fill();
        } else if (planet.name === "Mercury") {
          g.fillStyle = "rgba(0,0,0,0.25)";
          for (let i = 0; i < 6; i++) {
            const a = Math.random() * Math.PI * 2;
            const rr = r * 0.55 * Math.random();
            const rx = cx + Math.cos(a) * rr * 0.75;
            const ry = cy + Math.sin(a) * rr * 0.75;
            const cr = r * 0.07 * (0.5 + Math.random());
            g.beginPath();
            g.arc(rx, ry, cr, 0, Math.PI * 2);
            g.fill();
          }
        } else if (planet.name === "Neptune" || planet.name === "Uranus" || planet.name === "Venus") {
          g.globalAlpha = 0.15;
          g.fillStyle = "#ffffff";
          g.beginPath();
          g.ellipse(cx, cy, r * 0.88, r * 0.5, 0, 0, Math.PI * 2);
          g.fill();
          g.globalAlpha = 1;
        }

        return c.toDataURL("image/png");
      }

      const quizContent = document.getElementById("quizContent");
      const quizStatus = document.getElementById("quizStatus");
      const quizControls = document.getElementById("quizControls");
      const hintBtn = document.getElementById("hintBtn");
      const submitAnswerBtn = document.getElementById("submitAnswerBtn");
      const nextQuestionBtn = document.getElementById("nextQuestionBtn");

      // ì´ˆê¸° ì„¤ì •ê°’
      let timeScale = parseInt(timeSlider.value, 10) || 100;
      let orbitMode = "2d";
      let selectedPlanetIndex = 2; // ê¸°ë³¸: Earth
      let globalRotation = 0;
      let zoom = 1;
      let isDragging = false;
      let lastMouseX = 0;
      let lastMouseY = 0;
      let panX = 0;
      let panY = 0;
      let showOrbits = true;
      let showLabels = false;
      let paused = false;
      // ë³„ìë¦¬(í•˜ëŠ˜) ëª¨ë“œ ìƒíƒœ
      let skyUseGeocentric = true; // true: ì§€êµ¬ì¤‘ì‹¬(ì²œë™ì„¤ì  ì‹œê°í™”), false: íƒœì–‘ì¤‘ì‹¬(ì§€ë™ì„¤ì  ë¹„êµ)
      let skyShowTrails = true;
      let skyHighlightRetrograde = true;
      let skyTrailTimer = 0;
      const SKY_TRAIL_SAMPLE_SEC = 0.08;
      const SKY_TRAIL_MAX = 220;

      // ì‚¬ìš©ìê°€ í–‰ì„±ì„ í™•ëŒ€í•  ë•Œ ì´ì „ ìƒíƒœ ì €ì¥ìš© ë³€ìˆ˜
      let savedState = null;

      timeLabel.textContent = `x${timeScale}`;

      timeSlider.addEventListener("input", () => {
        timeScale = parseInt(timeSlider.value, 10);
        timeLabel.textContent = `x${timeScale}`;
        saveSettings();
      });

      // í–‰ì„± ë°ì´í„° ì •ì˜
      const planets = [
        {
          name: "Mercury",
          displayName: "ìˆ˜ì„±",
          color: "#c2b280",
          orbitScale: 0.6,
          size: 4,
          orbitalPeriodDays: 88,
          radiusKm: "2,440 km",
          rotationHours: "1,408ì‹œê°„",
          temp: "~167â„ƒ",
          description:
            "íƒœì–‘ì— ê°€ì¥ ê°€ê¹Œìš´ í–‰ì„±ìœ¼ë¡œ, ëŒ€ê¸°ê°€ ê±°ì˜ ì—†ì–´ ë‚®ê³¼ ë°¤ì˜ ì˜¨ë„ ì°¨ê°€ ë§¤ìš° í½ë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/mercury.jpg",
          nasaUrl: "https://science.nasa.gov/mercury/",
          image: null,
        },
        {
          name: "Venus",
          displayName: "ê¸ˆì„±",
          color: "#facc15",
          orbitScale: 0.9,
          size: 6,
          orbitalPeriodDays: 225,
          radiusKm: "6,052 km",
          rotationHours: "âˆ’5,832ì‹œê°„",
          temp: "~464â„ƒ",
          description:
            "ë‘êº¼ìš´ ì´ì‚°í™”íƒ„ì†Œ ëŒ€ê¸°ì™€ ê°•í•œ ì˜¨ì‹¤ íš¨ê³¼ë¡œ íƒœì–‘ê³„ì—ì„œ ê°€ì¥ ëœ¨ê±°ìš´ í–‰ì„±ì…ë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/venus.jpg",
          nasaUrl: "https://science.nasa.gov/venus/",
          image: null,
        },
        {
          name: "Earth",
          displayName: "ì§€êµ¬",
          color: "#22c55e",
          orbitScale: 1.2,
          size: 6.5,
          orbitalPeriodDays: 365,
          radiusKm: "6,371 km",
          rotationHours: "24ì‹œê°„",
          temp: "~15â„ƒ (í‰ê· )",
          description:
            "ë¬¼ê³¼ ëŒ€ê¸°ê°€ ì¡´ì¬í•˜ë©°, ìƒëª…ì²´ê°€ ë°œê²¬ëœ ìœ ì¼í•œ í–‰ì„±ì…ë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/earth.jpg",
          nasaUrl: "https://science.nasa.gov/earth/",
          image: null,
        },
        {
          name: "Mars",
          displayName: "í™”ì„±",
          color: "#f97316",
          orbitScale: 1.6,
          size: 5,
          orbitalPeriodDays: 687,
          radiusKm: "3,390 km",
          rotationHours: "24.6ì‹œê°„",
          temp: "~âˆ’63â„ƒ",
          description:
            "ë¶‰ì€ìƒ‰ì„ ë ëŠ” ì•”ì„ í–‰ì„±ìœ¼ë¡œ, ê³¼ê±°ì— ë¬¼ì´ í˜ë €ë˜ í”ì ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/mars_new.png",
          nasaUrl: "https://science.nasa.gov/mars/",
          image: null,
        },
        {
          name: "Jupiter",
          displayName: "ëª©ì„±",
          color: "#facc6b",
          orbitScale: 2.3,
          size: 10,
          orbitalPeriodDays: 4333,
          radiusKm: "69,911 km",
          rotationHours: "9.9ì‹œê°„",
          temp: "~âˆ’108â„ƒ",
          description:
            "íƒœì–‘ê³„ì—ì„œ ê°€ì¥ í° ê°€ìŠ¤í˜• í–‰ì„±ìœ¼ë¡œ, ì»¤ë‹¤ë€ ë¶‰ì€ ë°˜ì (ëŒ€ì ë°˜)ì´ ìœ ëª…í•©ë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/jupiter.jpg",
          nasaUrl: "https://science.nasa.gov/jupiter/",
          image: null,
        },
        {
          name: "Saturn",
          displayName: "í† ì„±",
          color: "#e5e7eb",
          orbitScale: 2.8,
          size: 9,
          orbitalPeriodDays: 10759,
          radiusKm: "58,232 km",
          rotationHours: "10.7ì‹œê°„",
          temp: "~âˆ’139â„ƒ",
          description:
            "ì•„ë¦„ë‹¤ìš´ ê³ ë¦¬ë¡œ ìœ ëª…í•œ ê°€ìŠ¤í˜• í–‰ì„±ìœ¼ë¡œ, ì–¼ìŒê³¼ ë¨¼ì§€ë¡œ ì´ë£¨ì–´ì§„ ê³ ë¦¬ë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/saturn.jpg",
          nasaUrl: "https://science.nasa.gov/saturn/",
          image: null,
        },
        {
          name: "Uranus",
          displayName: "ì²œì™•ì„±",
          color: "#38bdf8",
          orbitScale: 3.3,
          size: 8,
          orbitalPeriodDays: 30687,
          radiusKm: "25,362 km",
          rotationHours: "âˆ’17.2ì‹œê°„",
          temp: "~âˆ’197â„ƒ",
          description:
            "ìì „ì¶•ì´ ì˜†ìœ¼ë¡œ ëˆ„ìš´ ë…íŠ¹í•œ í–‰ì„±ìœ¼ë¡œ, ì˜†ìœ¼ë¡œ êµ¬ë¥´ë“¯ì´ ê³µì „í•©ë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/uranus.jpg",
          nasaUrl: "https://science.nasa.gov/uranus/",
          image: null,
        },
        {
          name: "Neptune",
          displayName: "í•´ì™•ì„±",
          color: "#1d4ed8",
          orbitScale: 3.8,
          size: 8,
          orbitalPeriodDays: 60190,
          radiusKm: "24,622 km",
          rotationHours: "16ì‹œê°„",
          temp: "~âˆ’201â„ƒ",
          description:
            "ê°•í•œ ë°”ëŒê³¼ í­í’ì´ ë¶€ëŠ” í‘¸ë¥¸ ìƒ‰ì˜ ê°€ìŠ¤ í–‰ì„±ìœ¼ë¡œ, íƒœì–‘ê³„ì—ì„œ ê°€ì¥ ë°”ê¹¥ìª½ì— ìˆìŠµë‹ˆë‹¤.",
          angle: Math.random() * Math.PI * 2,
          screenX: 0,
          screenY: 0,
          imgSrc: "./planets/neptune.jpg",
          nasaUrl: "https://science.nasa.gov/neptune/",
          image: null,
        },
      ];

      // ì´ë¯¸ì§€ ë¡œë“œ + ìë™ ì˜¤í”„ì…‹ ì¶”ì •(ë””ìŠ¤í¬ ì¤‘ì‹¬ ê·¼ì‚¬)
      function computeImageAutoOffset(img) {
        try {
          const S = 128;
          const c = document.createElement('canvas');
          c.width = c.height = S;
          const g = c.getContext('2d');
          // containìœ¼ë¡œ ì¶•ì†Œí•´ ì¤‘ì•™ ë°°ì¹˜í•œ ë’¤ ì¤‘ì‹¬ ì§ˆëŸ‰ ì¶”ì •
          const sw = img.naturalWidth || img.width;
          const sh = img.naturalHeight || img.height;
          const scale = Math.min(S / sw, S / sh);
          const dw = sw * scale;
          const dh = sh * scale;
          const dx = (S - dw) / 2;
          const dy = (S - dh) / 2;
          g.drawImage(img, 0, 0, sw, sh, dx, dy, dw, dh);
          const { data } = g.getImageData(0, 0, S, S);
          let sum = 0, cx = 0, cy = 0;
          for (let y = 0; y < S; y++) {
            for (let x = 0; x < S; x++) {
              const i = (y * S + x) * 4;
              const r = data[i], gg = data[i+1], b = data[i+2];
              const lum = 0.2126*r + 0.7152*gg + 0.0722*b;
              if (lum > 20) { // ì–´ë‘ìš´ ë°°ê²½ ë¬´ì‹œ
                sum += lum;
                cx += x * lum;
                cy += y * lum;
              }
            }
          }
          if (sum <= 0) return {x:0,y:0};
          cx /= sum; cy /= sum;
          // -0.5~0.5 ê·¼ì²˜ ê°’ìœ¼ë¡œ ì •ê·œí™”
          return { x:(cx - S/2)/S, y:(cy - S/2)/S };
        } catch (_) {
          return {x:0,y:0};
        }
      }

      planets.forEach((p) => {
        const img = new Image();
        img.onload = () => {
          const off = computeImageAutoOffset(img);
          p.autoOffsetX = off.x || 0;
          p.autoOffsetY = off.y || 0;
        };
        img.src = p.imgSrc;
        p.image = img;
      });

      // í–‰ì„± ì •ë³´ ì—…ë°ì´íŠ¸
      function updatePlanetInfo() {
        const p = planets[selectedPlanetIndex];
        planetNameElem.textContent = `${p.displayName} (${p.name})`;
        planetRadiusElem.textContent = p.radiusKm;
        planetOrbitElem.textContent = `${p.orbitalPeriodDays.toLocaleString(
          "ko-KR"
        )}ì¼`;
        planetRotationElem.textContent = p.rotationHours;
        planetTempElem.textContent = p.temp;
        planetDescElem.textContent = p.description;
      }

      planetSelect.addEventListener("change", (e) => {
        const idx = parseInt(e.target.value, 10);
        if (!isNaN(idx)) {
          selectedPlanetIndex = idx;
          updatePlanetInfo();
          // ì„ íƒëœ í–‰ì„±ìœ¼ë¡œ í™•ëŒ€í•˜ê³  íŒì—… í‘œì‹œ
          const p = planets[idx];
          focusOnPlanet(p);
          showPlanetPopup(p);
        }
      });

      // ê¶¤ë„ ëª¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
      orbitButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          orbitButtons.forEach((b) => {
            b.classList.remove("active");
            b.setAttribute("aria-pressed", "false");
          });
          btn.classList.add("active");
          btn.setAttribute("aria-pressed", "true");
          orbitMode = btn.dataset.mode || "2d";
          saveSettings();
        });
      });

      // ë³´ê¸° ì˜µì…˜ í† ê¸€
      toggleOrbitsBtn.addEventListener("click", () => {
        showOrbits = !showOrbits;
        toggleOrbitsBtn.classList.toggle("active", showOrbits);
        toggleOrbitsBtn.setAttribute("aria-pressed", showOrbits ? "true" : "false");
        saveSettings();
      });
      toggleLabelsBtn.addEventListener("click", () => {
        showLabels = !showLabels;
        toggleLabelsBtn.classList.toggle("active", showLabels);
        toggleLabelsBtn.setAttribute("aria-pressed", showLabels ? "true" : "false");
        saveSettings();
      });

      // ë³„ìë¦¬ ë³´ê¸° ì˜µì…˜
      toggleSkyCenterBtn.addEventListener("click", () => {
        skyUseGeocentric = !skyUseGeocentric;
        toggleSkyCenterBtn.classList.toggle("active", skyUseGeocentric);
        toggleSkyCenterBtn.textContent = skyUseGeocentric ? 'ì§€êµ¬ì¤‘ì‹¬' : 'íƒœì–‘ì¤‘ì‹¬';
        toggleSkyCenterBtn.setAttribute("aria-pressed", skyUseGeocentric ? "true" : "false");
        saveSettings();
      });
      toggleSkyTrailsBtn.addEventListener("click", () => {
        skyShowTrails = !skyShowTrails;
        toggleSkyTrailsBtn.classList.toggle("active", skyShowTrails);
        toggleSkyTrailsBtn.setAttribute("aria-pressed", skyShowTrails ? "true" : "false");
        saveSettings();
      });
      toggleRetrogradeBtn.addEventListener("click", () => {
        skyHighlightRetrograde = !skyHighlightRetrograde;
        toggleRetrogradeBtn.classList.toggle("active", skyHighlightRetrograde);
        toggleRetrogradeBtn.setAttribute("aria-pressed", skyHighlightRetrograde ? "true" : "false");
        saveSettings();
      });

      // ì¬ìƒ/ì¼ì‹œì •ì§€, ë³´ê¸° ì´ˆê¸°í™”, ìŠ¤í¬ë¦°ìƒ· ì €ì¥
      playPauseBtn.addEventListener("click", () => {
        paused = !paused;
        playPauseBtn.textContent = paused ? "â–¶ï¸ ì¬ìƒ" : "â¸ï¸ ì¼ì‹œì •ì§€";
        playPauseBtn.setAttribute("aria-pressed", paused ? "false" : "true");
      });
      function resetView() {
        zoom = 1;
        panX = 0;
        panY = 0;
        globalRotation = 0;
        savedState = null;
      }
      resetViewBtn.addEventListener("click", () => {
        resetView();
      });
      screenshotBtn.addEventListener("click", () => {
        try {
          const data = canvas.toDataURL("image/png");
          const a = document.createElement("a");
          const ts = new Date().toISOString().replace(/[:.]/g, "-");
          a.href = data;
          a.download = `solar-snapshot-${ts}.png`;
          document.body.appendChild(a);
          a.click();
          a.remove();
        } catch (e) {
          alert("ìŠ¤í¬ë¦°ìƒ· ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
      });

      // íŒì—… ë‹«ê¸° ê¸°ëŠ¥
      popupClose.addEventListener("click", () => {
        popup.classList.remove("visible");
        if (savedState) {
          // ì´ì „ ìƒíƒœ ë³µì›
          ({ zoom, panX, panY } = savedState);
          savedState = null;
        }
      });
      popup.addEventListener("click", (e) => {
        if (e.target === popup) {
          popup.classList.remove("visible");
          if (savedState) {
            ({ zoom, panX, panY } = savedState);
            savedState = null;
          }
        }
      });

      // ë³„ ë°°ê²½ ìƒì„±
      const stars = [];
      for (let i = 0; i < 80; i++) {
        stars.push({
          x: Math.random(),
          y: Math.random(),
          size: Math.random() * 1.4 + 0.6,
          alpha: Math.random() * 0.5 + 0.2,
        });
      }

      function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        const ratio = window.devicePixelRatio || 1;
        canvas.width = rect.width * ratio;
        canvas.height = rect.height * ratio;
        ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
      loadSettings();
      updatePlanetInfo();

      let lastTimestamp = 0;

      function update(dt) {
        const baseFactor = timeScale / 100;
        planets.forEach((p) => {
          const angularSpeed = (2 * Math.PI) / p.orbitalPeriodDays;
          p.angle += angularSpeed * dt * baseFactor;
        });

        // ë³„ìë¦¬(ì§€êµ¬ ì‹œì ) ê°ë„/ì—­í–‰ ê³„ì‚° ë° ê¶¤ì  ëˆ„ì 
        const earth = planets[2];
        const ex = earth.orbitScale * Math.cos(earth.angle);
        const ey = earth.orbitScale * Math.sin(earth.angle);
        planets.forEach((p, idx) => {
          const px = p.orbitScale * Math.cos(p.angle);
          const py = p.orbitScale * Math.sin(p.angle);
          let rx, ry;
          if (skyUseGeocentric) {
            // ì§€êµ¬ ê¸°ì¤€ ë²¡í„°
            rx = px - ex;
            ry = py - ey;
          } else {
            // íƒœì–‘ ê¸°ì¤€(ë¹„êµìš©)
            rx = px;
            ry = py;
          }
          const prev = p.skyAngle ?? Math.atan2(ry, rx);
          const now = Math.atan2(ry, rx);
          p.prevSkyAngle = prev;
          p.skyAngle = now;
          // ì—­í–‰ íŒì •: ê°ì†ë„ ë¶€í˜¸(ì§€êµ¬ì¤‘ì‹¬ì¼ ë•Œë§Œ ì˜ë¯¸)
          const d = Math.atan2(Math.sin(now - prev), Math.cos(now - prev));
          p.isRetrograde = skyUseGeocentric ? d < 0 : false;
          // ê¶¤ì  ê¸°ë¡(ì§€êµ¬ ì œì™¸)
          if (idx !== 2) {
            if (skyTrailTimer > SKY_TRAIL_SAMPLE_SEC) {
              p.skyTrail = p.skyTrail || [];
              p.skyTrail.push({ a: now, r: p.isRetrograde });
              if (p.skyTrail.length > SKY_TRAIL_MAX) p.skyTrail.shift();
            }
          }
        });
        skyTrailTimer += dt;
        if (skyTrailTimer > SKY_TRAIL_SAMPLE_SEC) skyTrailTimer = 0;
      }

      function draw() {
        const ratio = window.devicePixelRatio || 1;
        const w = canvas.width / ratio;
        const h = canvas.height / ratio;

        ctx.clearRect(0, 0, w, h);
        // ë°°ê²½ ê·¸ë¼ë°ì´ì…˜
        const gradient = ctx.createRadialGradient(
          w / 2,
          h / 2,
          0,
          w / 2,
          h / 2,
          Math.max(w, h) * 0.7
        );
        gradient.addColorStop(0, "#020617");
        gradient.addColorStop(1, "#000000");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, w, h);

        // ë³„ ê·¸ë¦¬ê¸°
        ctx.save();
        ctx.globalAlpha = 0.9;
        stars.forEach((s) => {
          ctx.beginPath();
          ctx.arc(w * s.x, h * s.y, s.size, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(148, 163, 184, ${s.alpha})`;
          ctx.fill();
        });
        ctx.restore();

        const cx = w / 2 + panX;
        const cy = h / 2 + panY;
        const baseScale = Math.min(w, h) / 4.2;
        const tilt = orbitMode === "3d" ? 0.55 : 1;

        const cosR = Math.cos(globalRotation);
        const sinR = Math.sin(globalRotation);

        // ê¶¤ë„ ë Œë”ë§ (2D/3D ëª¨ë“œì—ì„œë§Œ)
        if (showOrbits && (orbitMode === "2d" || orbitMode === "3d")) {
          ctx.save();
          ctx.translate(cx, cy);
          ctx.rotate(globalRotation);
          planets.forEach((p) => {
            const orbitRadius = p.orbitScale * baseScale * zoom;
            ctx.beginPath();
            ctx.ellipse(
              0,
              0,
              orbitRadius,
              orbitRadius * tilt,
              0,
              0,
              Math.PI * 2
            );
            ctx.strokeStyle = "rgba(148, 163, 184, 0.35)";
            ctx.lineWidth = 1;
            ctx.stroke();
          });
          ctx.restore();
        }

        // íƒœì–‘ ê·¸ë¦¬ê¸°
        const sunRadius = 10 * zoom;
        ctx.beginPath();
        ctx.arc(cx, cy, sunRadius, 0, Math.PI * 2);
        const sunGrad = ctx.createRadialGradient(
          cx,
          cy,
          0,
          cx,
          cy,
          sunRadius * 3
        );
        sunGrad.addColorStop(0, "#facc15");
        sunGrad.addColorStop(0.5, "#f97316");
        sunGrad.addColorStop(1, "rgba(248, 250, 252, 0)");
        ctx.fillStyle = sunGrad;
        ctx.fill();

        // ê° í–‰ì„± ê·¸ë¦¬ê¸°
        planets.forEach((p, index) => {
          let xLocal = p.orbitScale * baseScale * Math.cos(p.angle);
          let yLocal = p.orbitScale * baseScale * Math.sin(p.angle);

          let xr = xLocal * cosR - yLocal * sinR;
          let yr = (xLocal * sinR + yLocal * cosR) * (orbitMode === "3d" ? tilt : 1);

          let sx, sy;
          if (orbitMode === "constellation") {
            // ë³„ìë¦¬ ëª¨ë“œ: í•˜ëŠ˜ì˜ ì›(ì²œêµ¬) ìœ„ íˆ¬ì˜
            const radius = baseScale * 1.2 * zoom;
            if (p.name === "Earth") {
              // ì§€êµ¬ëŠ” ì¤‘ì‹¬
              sx = cx;
              sy = cy;
            } else {
              const ang = (p.skyAngle ?? Math.atan2(yLocal, xLocal)) + globalRotation;
              sx = cx + Math.cos(ang) * radius;
              sy = cy + Math.sin(ang) * radius;
            }
          } else {
            sx = cx + xr * zoom;
            sy = cy + yr * zoom;
          }
          p.screenX = sx;
          p.screenY = sy;

          let size = p.size * zoom;
          if (index === selectedPlanetIndex) {
            size *= 1.1;
          }
          const imgSize = size * 4; // ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • (í–‰ì„± í¬ê¸°ì— ë¹„ë¡€)

          // í–‰ì„± ë Œë”ë§: ì›í˜• ë§ˆìŠ¤í¬ + cover í¬ë¡­ + ìë™/ìˆ˜ë™ ì˜¤í”„ì…‹
          const drawCircleFill = (radius) => {
            ctx.beginPath();
            ctx.arc(sx, sy, radius, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
          };
          const drawCover = (img) => {
            const sw = img.naturalWidth || img.width;
            const sh = img.naturalHeight || img.height;
            if (!sw || !sh) return;
            // ì†ŒìŠ¤ ì •ì‚¬ê°í˜•ì„ ì¤‘ì•™ì—ì„œ ì˜ë¼ ëª©í‘œ ì›ì— ê½‰ ì°¨ê²Œ ê·¸ë¦¬ê¸°
            const s = Math.min(sw, sh);
            // ìë™+ìˆ˜ë™ ì˜¤í”„ì…‹ ì ìš© (ì†ŒìŠ¤ ì •ì‚¬ê° ë‚´ë¶€ì—ì„œ ì¤‘ì‹¬ ì´ë™)
            const ox = (p.imgOffsetX || 0) + (p.autoOffsetX || 0); // -0.5~0.5 ì¶”ì²œ
            const oy = (p.imgOffsetY || 0) + (p.autoOffsetY || 0);
            let sx0 = sw/2 - s/2 + ox * s * 0.6; // 0.6: ê³¼ë„ ì›€ì§ì„ ë°©ì§€
            let sy0 = sh/2 - s/2 + oy * s * 0.6;
            sx0 = Math.max(0, Math.min(sw - s, sx0));
            sy0 = Math.max(0, Math.min(sh - s, sy0));
            ctx.drawImage(
              img,
              sx0,
              sy0,
              s,
              s,
              sx - imgSize/2,
              sy - imgSize/2,
              imgSize,
              imgSize
            );
          };
          ctx.save();
          ctx.beginPath();
          ctx.arc(sx, sy, imgSize / 2, 0, Math.PI * 2);
          ctx.closePath();
          ctx.clip();
          // ë°‘ìƒ‰ ë¨¼ì € ì±„ì›Œ ì´ë¯¸ì§€ ê°€ì¥ìë¦¬ ë¹ˆ ê³µê°„ ë³´ì •
          drawCircleFill(imgSize / 2);
          ctx.imageSmoothingEnabled = true;
          ctx.imageSmoothingQuality = 'high';
          if (p.name === 'Saturn') {
            // í† ì„±: í…ìŠ¤ì²˜ ëŒ€ì‹  ë°‘ìƒ‰ë§Œ(ê³ ë¦¬ëŠ” ì•„ë˜ì—ì„œ ë³„ë„ ë Œë”)
          } else if (p.image && p.image.complete && p.image.naturalWidth > 0 && p.image.naturalHeight > 0) {
            drawCover(p.image);
          } else if (p.placeholderImage && p.placeholderImage.complete) {
            drawCover(p.placeholderImage);
          }
          ctx.restore();

          // í† ì„± ê³ ë¦¬ ì˜¤ë²„ë ˆì´(ë§ˆìŠ¤í¬ í•´ì œ í›„ ê·¸ë¦¬ê¸°: ì˜ë¦¼ ë°©ì§€)
          if (p.name === 'Saturn') {
            ctx.save();
            ctx.translate(sx, sy);
            ctx.rotate(globalRotation);
            ctx.scale(1, orbitMode === '3d' ? tilt : 1);
            const r = imgSize * 0.46;     // í–‰ì„± ë””ìŠ¤í¬ ê·¼ì‚¬ ë°˜ì§€ë¦„
            const rout = r * 1.65;        // ê³ ë¦¬ ë°”ê¹¥
            const rin = r * 0.95;         // ê³ ë¦¬ ì•ˆìª½
            // evenoddë¡œ ë„ë„› ëª¨ì–‘ ì±„ìš°ê¸°
            ctx.beginPath();
            ctx.ellipse(0, 0, rout, rout * 0.42, 0, 0, Math.PI * 2);
            ctx.ellipse(0, 0, rin, rin * 0.36, 0, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(229, 231, 235, 0.28)';
            ctx.fill('evenodd');
            // ê²° ë¹› ê°•ì¡°ì„ 
            ctx.beginPath();
            ctx.ellipse(0, 0, (rout + rin)/2, ((rout + rin)/2) * 0.39, 0, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(229, 231, 235, 0.45)';
            ctx.lineWidth = 1;
            ctx.stroke();
            ctx.restore();
          }
          // ì„ íƒëœ í–‰ì„±ì˜ í•˜ì´ë¼ì´íŠ¸ ë§
          if (index === selectedPlanetIndex) {
            ctx.beginPath();
            ctx.arc(sx, sy, imgSize / 2 + 2, 0, Math.PI * 2);
            ctx.strokeStyle = "rgba(248, 250, 252, 0.9)";
            ctx.lineWidth = 1.5;
            ctx.stroke();
          }
          // í–‰ì„± ì´ë¦„ í‘œì‹œ (ì˜µì…˜ ë˜ëŠ” ë³„ìë¦¬ ëª¨ë“œì—ì„œ)
          if (showLabels || orbitMode === "constellation") {
            ctx.font = "10px system-ui";
            const labelColor = orbitMode === 'constellation' && p.isRetrograde && skyHighlightRetrograde ? 'rgba(251, 113, 133, 0.95)' : 'rgba(248, 250, 252, 0.85)';
            ctx.fillStyle = labelColor;
            const label = index === 2 ? "ì§€êµ¬(Earth)" : `${p.displayName}`;
            ctx.fillText(label, sx + 6, sy - 6);
          }
        });

        // ë³„ìë¦¬ ëª¨ë“œ: ì²œêµ¬ ì› ë° ê¶¤ì (ì—­í–‰ ê°•ì¡°) ê·¸ë¦¬ê¸°
        if (orbitMode === "constellation") {
          const radius = baseScale * 1.2 * zoom;
          // í•˜ëŠ˜ ì›(ì²œêµ¬)
          ctx.beginPath();
          ctx.arc(cx, cy, radius, 0, Math.PI * 2);
          ctx.strokeStyle = "rgba(148, 163, 184, 0.35)";
          ctx.lineWidth = 1;
          ctx.stroke();
          // ê¶¤ì  í‘œì‹œ
          if (skyShowTrails) {
            planets.forEach((p, idx) => {
              if (idx === 2 || !p.skyTrail || p.skyTrail.length < 2) return;
              for (let i = 1; i < p.skyTrail.length; i++) {
                const a0 = (p.skyTrail[i - 1].a + globalRotation);
                const a1 = (p.skyTrail[i].a + globalRotation);
                const x0 = cx + Math.cos(a0) * radius;
                const y0 = cy + Math.sin(a0) * radius;
                const x1 = cx + Math.cos(a1) * radius;
                const y1 = cy + Math.sin(a1) * radius;
                const retro = skyHighlightRetrograde && p.skyTrail[i].r;
                ctx.beginPath();
                ctx.moveTo(x0, y0);
                ctx.lineTo(x1, y1);
                ctx.strokeStyle = retro ? 'rgba(251, 113, 133, 0.8)' : 'rgba(148, 163, 184, 0.35)';
                ctx.lineWidth = retro ? 1.4 : 1;
                ctx.stroke();
              }
            });
          }
          // ì•ˆë‚´ í…ìŠ¤íŠ¸
          ctx.font = "11px system-ui";
          ctx.fillStyle = "rgba(248, 250, 252, 0.9)";
          const modeText = skyUseGeocentric ? "ì§€êµ¬ì¤‘ì‹¬: ì—­í–‰ ë°œìƒ ê°€ëŠ¥" : "íƒœì–‘ì¤‘ì‹¬: ì—­í–‰ ì—†ìŒ";
          ctx.fillText(modeText, cx - 70, cy + radius + 14);
        }
      }

      // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
      function animate(timestamp) {
        if (!lastTimestamp) lastTimestamp = timestamp;
        const dt = (timestamp - lastTimestamp) / 1000;
        lastTimestamp = timestamp;

        if (!paused) update(dt);
        draw();
        requestAnimationFrame(animate);
      }

      // í–‰ì„± í´ë¦­ ì‹œ í™•ëŒ€ ë° íŒì—… í‘œì‹œ
      function focusOnPlanet(p) {
        // í˜„ì¬ ìƒíƒœ ì €ì¥
        if (!savedState) {
          savedState = { zoom, panX, panY };
        }
        // í™•ëŒ€ ë¹„ìœ¨ ì„¤ì •
        zoom = Math.min(zoom * 2.5, 3);

        // í–‰ì„± ìœ„ì¹˜ ê³„ì‚°: í˜„ì¬ íšŒì „ ë° ê¸°ìš¸ê¸° ì ìš©
        const ratio = window.devicePixelRatio || 1;
        const w = canvas.width / ratio;
        const h = canvas.height / ratio;
        const baseScale = Math.min(w, h) / 4.2;
        const tilt = orbitMode === "3d" ? 0.55 : 1;
        let xLocal = p.orbitScale * baseScale * Math.cos(p.angle);
        let yLocal = p.orbitScale * baseScale * Math.sin(p.angle);
        const cosR = Math.cos(globalRotation);
        const sinR = Math.sin(globalRotation);
        let xr = xLocal * cosR - yLocal * sinR;
        let yr = (xLocal * sinR + yLocal * cosR) * (orbitMode === "3d" ? tilt : 1);
        let sx, sy;
        const cx = w / 2 + panX;
        const cy = h / 2 + panY;
        if (orbitMode === "constellation") {
          const radius = baseScale * 1.5 * zoom;
          if (p.name === "Earth") {
            sx = cx;
            sy = cy;
          } else {
            sx = cx + Math.cos(p.angle) * radius;
            sy = cy + Math.sin(p.angle) * radius;
          }
        } else {
          sx = cx + xr * zoom;
          sy = cy + yr * zoom;
        }
        // ì¤‘ì•™ìœ¼ë¡œ ì´ë™
        panX += (w / 2 - sx);
        panY += (h / 2 - sy);
      }

      function showPlanetPopup(planet) {
        popupPlanetName.textContent = `${planet.displayName} (${planet.name})`;
        popupPlanetText.textContent = planet.description;
        if (
          planet.image &&
          planet.image.complete &&
          planet.image.naturalWidth > 0 &&
          planet.image.naturalHeight > 0
        ) {
          popupPlanetImg.src = planet.imgSrc;
        } else {
          if (!planet.placeholderImage) {
            const tmp = new Image();
            tmp.src = generatePlanetPlaceholder(planet, 512);
            planet.placeholderImage = tmp;
          }
          popupPlanetImg.src = planet.placeholderImage.complete
            ? planet.placeholderImage.src
            : generatePlanetPlaceholder(planet, 512);
        }
        // ì´ë¯¸ì§€ í‘œì‹œ ë°©ì‹: contain + ìë™ ì¤‘ì‹¬ ë³´ì •(object-position)
        try {
          const ox = ((planet.autoOffsetX || 0) + (planet.imgOffsetX || 0)) * 60; // -30%~+30%
          const oy = ((planet.autoOffsetY || 0) + (planet.imgOffsetY || 0)) * 60;
          popupPlanetImg.style.objectFit = 'contain';
          popupPlanetImg.style.objectPosition = `calc(50% + ${ox}%) calc(50% + ${oy}%)`;
          popupPlanetImg.alt = `${planet.displayName} (${planet.name}) ì´ë¯¸ì§€`;
        } catch (_) {}
        // NASA ë§í¬ ë™ì  ìƒì„±/ì—…ë°ì´íŠ¸
        try {
          const body = popup.querySelector('.popup-body');
          let link = document.getElementById('popupNasaLink');
          if (!link && body) {
            link = document.createElement('a');
            link.id = 'popupNasaLink';
            link.target = '_blank';
            link.rel = 'noopener';
            link.className = 'primary-btn';
            link.style.display = 'inline-block';
            link.style.textDecoration = 'none';
            link.textContent = 'NASA í˜ì´ì§€ì—ì„œ ë” ì•Œì•„ë³´ê¸° â†—';
            const pwrap = document.createElement('p');
            pwrap.style.marginTop = '6px';
            pwrap.appendChild(link);
            body.appendChild(pwrap);
          }
          if (link) {
            link.href = planet.nasaUrl || 'https://science.nasa.gov/solar-system/planets/';
          }
        } catch (e) { /* ignore */ }
        popup.classList.add("visible");
      }

      canvas.addEventListener("click", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        let clickedIndex = -1;
        planets.forEach((p, i) => {
          const dx = x - p.screenX;
          const dy = y - p.screenY;
          const hitRadius = (p.size * zoom * 4) / 2;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist <= hitRadius * 1.1) {
            clickedIndex = i;
          }
        });
        if (clickedIndex >= 0) {
          selectedPlanetIndex = clickedIndex;
          planetSelect.value = String(clickedIndex);
          updatePlanetInfo();
          const p = planets[clickedIndex];
          focusOnPlanet(p);
          showPlanetPopup(p);
        }
      });

      // ë“œë˜ê·¸ ë° ì¤Œ ì¸í„°ë™ì…˜
      canvas.addEventListener("mousedown", (e) => {
        isDragging = true;
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
      });
      window.addEventListener("mouseup", () => {
        isDragging = false;
      });
      window.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        const dx = e.clientX - lastMouseX;
        const dy = e.clientY - lastMouseY;
        if (e.shiftKey) {
          zoom *= 1 + dx * 0.002;
          zoom = Math.max(0.3, Math.min(zoom, 3));
        } else {
          globalRotation += dx * 0.003;
          panY += dy * 0.4;
        }
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
      });
      canvas.addEventListener("wheel", (e) => {
        e.preventDefault();
        const delta = -e.deltaY;
        if (delta > 0) {
          zoom *= 1.1;
        } else {
          zoom /= 1.1;
        }
        zoom = Math.max(0.3, Math.min(zoom, 3));
      });

      // ë”ë¸”í´ë¦­ìœ¼ë¡œ ë³´ê¸° ì´ˆê¸°í™”
      canvas.addEventListener("dblclick", () => {
        resetView();
      });

      // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤: Space=ì¬ìƒ/ì¼ì‹œì •ì§€, R=ë³´ê¸° ì´ˆê¸°í™”, O=ê¶¤ë„ í† ê¸€, L=ë¼ë²¨ í† ê¸€
      window.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          paused = !paused;
          playPauseBtn.textContent = paused ? "â–¶ï¸ ì¬ìƒ" : "â¸ï¸ ì¼ì‹œì •ì§€";
          playPauseBtn.setAttribute("aria-pressed", paused ? "false" : "true");
        } else if (e.key && e.key.toLowerCase() === "r") {
          resetView();
        } else if (e.key && e.key.toLowerCase() === "o") {
          showOrbits = !showOrbits;
          toggleOrbitsBtn.classList.toggle("active", showOrbits);
          toggleOrbitsBtn.setAttribute("aria-pressed", showOrbits ? "true" : "false");
          saveSettings();
        } else if (e.key && e.key.toLowerCase() === "l") {
          showLabels = !showLabels;
          toggleLabelsBtn.classList.toggle("active", showLabels);
          toggleLabelsBtn.setAttribute("aria-pressed", showLabels ? "true" : "false");
          saveSettings();
        } else if (e.key && e.key.toLowerCase() === 'g') {
          // G: ì§€êµ¬ì¤‘ì‹¬/íƒœì–‘ì¤‘ì‹¬ í† ê¸€
          skyUseGeocentric = !skyUseGeocentric;
          toggleSkyCenterBtn.classList.toggle('active', skyUseGeocentric);
          toggleSkyCenterBtn.textContent = skyUseGeocentric ? 'ì§€êµ¬ì¤‘ì‹¬' : 'íƒœì–‘ì¤‘ì‹¬';
          toggleSkyCenterBtn.setAttribute('aria-pressed', skyUseGeocentric ? 'true' : 'false');
          saveSettings();
        } else if (e.key && e.key.toLowerCase() === 't') {
          // T: ê¶¤ì  í‘œì‹œ í† ê¸€
          skyShowTrails = !skyShowTrails;
          toggleSkyTrailsBtn.classList.toggle('active', skyShowTrails);
          toggleSkyTrailsBtn.setAttribute('aria-pressed', skyShowTrails ? 'true' : 'false');
          saveSettings();
        } else if (e.key && e.key.toLowerCase() === 'p') {
          // P: ì—­í–‰ ê°•ì¡° í† ê¸€
          skyHighlightRetrograde = !skyHighlightRetrograde;
          toggleRetrogradeBtn.classList.toggle('active', skyHighlightRetrograde);
          toggleRetrogradeBtn.setAttribute('aria-pressed', skyHighlightRetrograde ? 'true' : 'false');
          saveSettings();
        }
      });

      // ì„¤ì • ì €ì¥/ë³µì›
      function saveSettings() {
        try {
          const data = { timeScale, orbitMode, showOrbits, showLabels, skyUseGeocentric, skyShowTrails, skyHighlightRetrograde };
          localStorage.setItem("solarAppSettings", JSON.stringify(data));
        } catch (_) {}
      }
      function loadSettings() {
        try {
          const raw = localStorage.getItem("solarAppSettings");
          if (!raw) return;
          const data = JSON.parse(raw);
          if (typeof data.timeScale === "number") {
            timeScale = data.timeScale;
            timeSlider.value = String(timeScale);
            timeLabel.textContent = `x${timeScale}`;
          }
          if (typeof data.skyUseGeocentric === 'boolean') {
            skyUseGeocentric = data.skyUseGeocentric;
            toggleSkyCenterBtn.classList.toggle('active', skyUseGeocentric);
            toggleSkyCenterBtn.textContent = skyUseGeocentric ? 'ì§€êµ¬ì¤‘ì‹¬' : 'íƒœì–‘ì¤‘ì‹¬';
            toggleSkyCenterBtn.setAttribute('aria-pressed', skyUseGeocentric ? 'true' : 'false');
          }
          if (typeof data.skyShowTrails === 'boolean') {
            skyShowTrails = data.skyShowTrails;
            toggleSkyTrailsBtn.classList.toggle('active', skyShowTrails);
            toggleSkyTrailsBtn.setAttribute('aria-pressed', skyShowTrails ? 'true' : 'false');
          }
          if (typeof data.skyHighlightRetrograde === 'boolean') {
            skyHighlightRetrograde = data.skyHighlightRetrograde;
            toggleRetrogradeBtn.classList.toggle('active', skyHighlightRetrograde);
            toggleRetrogradeBtn.setAttribute('aria-pressed', skyHighlightRetrograde ? 'true' : 'false');
          }
          if (typeof data.orbitMode === "string") {
            orbitMode = data.orbitMode;
            document.querySelectorAll('.orbit-mode-btn[data-mode]').forEach((b) => {
              const active = b.dataset.mode === orbitMode;
              b.classList.toggle('active', active);
              b.setAttribute('aria-pressed', active ? 'true' : 'false');
            });
          }
          if (typeof data.showOrbits === "boolean") {
            showOrbits = data.showOrbits;
            toggleOrbitsBtn.classList.toggle("active", showOrbits);
            toggleOrbitsBtn.setAttribute("aria-pressed", showOrbits ? "true" : "false");
          }
          if (typeof data.showLabels === "boolean") {
            showLabels = data.showLabels;
            toggleLabelsBtn.classList.toggle("active", showLabels);
            toggleLabelsBtn.setAttribute("aria-pressed", showLabels ? "true" : "false");
          }
        } catch (_) {}
      }

      // í€´ì¦ˆ ë°ì´í„°
      const quizQuestions = [
        {
          type: "mc",
          question: "íƒœì–‘ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ í–‰ì„±ì€ ë¬´ì—‡ì¸ê°€ìš”?",
          options: ["ìˆ˜ì„±", "ê¸ˆì„±", "ì§€êµ¬", "í™”ì„±"],
          answer: 0,
          hint: "ê³µì „ ì£¼ê¸°ê°€ ì•½ 88ì¼ë¡œ ê°€ì¥ ì§§ì•„ìš”.",
        },
        {
          type: "mc",
          question: "ì§€êµ¬ì˜ ê³µì „ ì£¼ê¸°ëŠ” ì•½ ë©°ì¹ ì¸ê°€ìš”?",
          options: ["88ì¼", "225ì¼", "365ì¼", "687ì¼"],
          answer: 2,
          hint: "1ë…„ê³¼ ê°™ì€ ê¸°ê°„ì…ë‹ˆë‹¤.",
        },
        {
          type: "mc",
          question: "ì•„ë¦„ë‹¤ìš´ ê³ ë¦¬ë¡œ ìœ ëª…í•œ í–‰ì„±ì€?",
          options: ["ëª©ì„±", "í† ì„±", "ì²œì™•ì„±", "í•´ì™•ì„±"],
          answer: 1,
          hint: "ì–¼ìŒê³¼ ë¨¼ì§€ë¡œ ì´ë£¨ì–´ì§„ ê³ ë¦¬ê°€ ìˆì–´ìš”.",
        },
        {
          type: "short",
          question:
            "í† ì„±ì„ ëŒ€í‘œí•˜ëŠ” íŠ¹ì§•ìœ¼ë¡œ, ì–¼ìŒê³¼ ë¨¼ì§€ë¡œ ì´ë£¨ì–´ì ¸ í–‰ì„±ì„ ë‘˜ëŸ¬ì‹¸ê³  ìˆëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
          answer: ["ê³ ë¦¬", "í† ì„±ì˜ ê³ ë¦¬"],
          hint: "í–‰ì„±ì„ ë‘˜ëŸ¬ì‹¼ 'ë§'ì„ ë– ì˜¬ë ¤ ë³´ì„¸ìš”.",
        },
        {
          type: "short",
          question:
            "ìš°ë¦¬ê°€ ì‚´ê³  ìˆëŠ” í–‰ì„±ì˜ ì´ë¦„ì„ í•œê¸€ë¡œ ì ì–´ ë³´ì„¸ìš”.",
          answer: ["ì§€êµ¬"],
          hint: "ë¬¼ê³¼ ëŒ€ê¸°ê°€ ìˆëŠ”, ìƒëª…ì²´ê°€ ì‚¬ëŠ” í–‰ì„±ì…ë‹ˆë‹¤.",
        },
      ];

      let quizIndex = 0;
      let quizScore = 0;
      let hintUsedThisQuestion = false;

      function updateQuizStatus() {
        quizStatus.textContent = `ì ìˆ˜: ${quizScore}ì  | ë¬¸ì œ ${
          quizIndex + 1
        } / ${quizQuestions.length}`;
      }

      function renderQuestion() {
        const q = quizQuestions[quizIndex];
        hintUsedThisQuestion = false;
        nextQuestionBtn.disabled = true;
        submitAnswerBtn.disabled = false;
        hintBtn.disabled = false;
        let html = `<p class="quiz-question">${q.question}</p>`;
        if (q.type === "mc") {
          html += '<ul class="quiz-options">';
          q.options.forEach((opt, idx) => {
            html += `\n              <li>\n                <label>\n                  <input type="radio" name="quizOption" value="${idx}" />\n                  <span>${opt}</span>\n                </label>\n              </li>`;
          });
          html += "</ul>";
        } else {
          html += `\n          <input\n            type="text"\n            id="quizShortAnswer"\n            class="quiz-input"\n            placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”"\n            autocomplete="off"\n          />`;
        }
        html += `<p class="quiz-hint" id="quizHint"></p>`;
        quizContent.innerHTML = html;
      }

      function startQuiz() {
        quizIndex = 0;
        quizScore = 0;
        hintUsedThisQuestion = false;
        quizControls.style.display = "flex";
        renderQuestion();
        updateQuizStatus();
      }

      function endQuiz() {
        quizControls.style.display = "none";
        let grade;
        if (quizScore >= 10) {
          grade = "Sê¸‰ íƒœì–‘ê³„ íƒí—˜ê°€";
        } else if (quizScore >= 6) {
          grade = "Aê¸‰ íƒœì–‘ê³„ íƒí—˜ê°€";
        } else {
          grade = "ë„ì „ ì¤‘ì¸ ìƒˆì‹¹ íƒí—˜ê°€";
        }
        quizContent.innerHTML = `\n          <p class="quiz-result">\n            í€´ì¦ˆ ì¢…ë£Œ! ë‹¹ì‹ ì˜ ì ìˆ˜ëŠ” <strong>${quizScore}ì </strong>ì…ë‹ˆë‹¤.\n          </p>\n          <p class="quiz-grade">\n            íšë“ ë“±ê¸‰: <strong>${grade}</strong>\n          </p>\n          <button type="button" id="retryQuizBtn" class="primary-btn">\n            ë‹¤ì‹œ ë„ì „í•˜ê¸°\n          </button>\n        `;
        const retryBtn = document.getElementById("retryQuizBtn");
        retryBtn.addEventListener("click", () => {
          startQuiz();
        });
      }

      quizToggleBtn.addEventListener("click", () => {
        startQuiz();
      });
      hintBtn.addEventListener("click", () => {
        const q = quizQuestions[quizIndex];
        const hintElem = document.getElementById("quizHint");
        if (!hintUsedThisQuestion) {
          quizScore = Math.max(quizScore - 1, 0);
          hintUsedThisQuestion = true;
          hintElem.textContent = `íŒíŠ¸: ${q.hint}`;
          updateQuizStatus();
        }
      });
      submitAnswerBtn.addEventListener("click", () => {
        const q = quizQuestions[quizIndex];
        let correct = false;
        if (q.type === "mc") {
          const selected = quizContent.querySelector(
            'input[name="quizOption"]:checked'
          );
          if (!selected) {
            alert("ë³´ê¸°ë¥¼ í•˜ë‚˜ ì„ íƒí•´ ì£¼ì„¸ìš”.");
            return;
          }
          const idx = parseInt(selected.value, 10);
          correct = idx === q.answer;
        } else {
          const input = document.getElementById("quizShortAnswer");
          if (!input || !input.value.trim()) {
            alert("ì •ë‹µì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
          }
          const value = input.value.trim();
          if (Array.isArray(q.answer)) {
            correct = q.answer.some((ans) => value.includes(ans));
          } else {
            correct = value.includes(q.answer);
          }
        }
        if (correct) {
          quizScore += 2;
          quizContent.insertAdjacentHTML(
            "beforeend",
            '<p class="quiz-feedback correct">ì •ë‹µì…ë‹ˆë‹¤! ğŸš€</p>'
          );
        } else {
          quizContent.insertAdjacentHTML(
            "beforeend",
            '<p class="quiz-feedback wrong">ì•„æƒœ! ì •ë‹µì´ ì•„ë‹™ë‹ˆë‹¤.</p>'
          );
        }
        submitAnswerBtn.disabled = true;
        nextQuestionBtn.disabled = false;
        hintBtn.disabled = true;
        updateQuizStatus();
        if (quizIndex === quizQuestions.length - 1) {
          nextQuestionBtn.textContent = "ê²°ê³¼ ë³´ê¸°";
        } else {
          nextQuestionBtn.textContent = "ë‹¤ìŒ ë¬¸ì œ";
        }
      });
      nextQuestionBtn.addEventListener("click", () => {
        if (quizIndex < quizQuestions.length - 1) {
          quizIndex++;
          renderQuestion();
          updateQuizStatus();
        } else {
          endQuiz();
        }
      });

      requestAnimationFrame(animate);
    });
  </script>
</body>
</html>
